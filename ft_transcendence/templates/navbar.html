<style>
    /* General Navbar Styling */
    nav {
        background-color: #003366; /* Dark Blue background for navbar */
        color: #ffffff; /* White text color for contrast */
        padding: 15px 20px; /* Padding for spacing */
        display: flex; /* Flexbox for alignment */
        justify-content: space-between; /* Space out items */
        align-items: center; /* Center items vertically */
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3); /* Shadow for depth */
    }
    
    /* Navbar Links Styling */
    .navbar-left a {
        color: #ffffff; /* White text for links */
        text-decoration: none; /* Remove underline from links */
        font-size: 18px; /* Font size for links */
        margin: 0 15px; /* Space between links */
        transition: color 0.3s ease; /* Smooth transition for hover effect */
    }
    
    .navbar-left a:hover {
        color: #cce0ff; /* Light blue color on hover */
    }
    
    /* Invitation Container Styling */
    .invitation-container {
        display: flex; /* Flexbox for horizontal alignment */
        align-items: center; /* Center items vertically */
    }
    
    #invitation-icon {
        color: #ffffff; /* White color for icon */
        font-size: 24px; /* Larger icon size */
        text-decoration: none; /* Remove underline from link */
        margin-right: 20px; /* Space between icon and badge */
        position: relative; /* Position for badge placement */
    }
    
    #invitation-icon .badge {
        background-color: #ff6f61; /* Red badge color */
        color: #ffffff; /* White text color */
        border-radius: 50%; /* Circular badge */
        padding: 5px 10px; /* Padding inside badge */
        font-size: 14px; /* Font size for badge text */
        position: absolute; /* Absolute positioning */
        top: -10px; /* Position badge above icon */
        right: -10px; /* Position badge to the right of icon */
        display: flex; /* Center text in badge */
        align-items: center; /* Center text vertically */
        justify-content: center; /* Center text horizontally */
    }
    
    /* Invitation List Styling */
    .invitation-list {
        display: none; /* Hidden by default */
        position: absolute; /* Position relative to icon */
        top: 40px; /* Position below icon */
        right: 0; /* Align to the right */
        background-color: #ffffff; /* Light background for dropdown */
        color: #333333; /* Dark text color for readability */
        border: 1px solid #dddddd; /* Light border for separation */
        border-radius: 5px; /* Rounded corners */
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3); /* Shadow for dropdown */
        padding: 10px; /* Padding inside dropdown */
        width: 250px; /* Fixed width for dropdown */
        z-index: 10; /* Ensure dropdown is above other content */
    }
    
    .invitation-list p {
        margin: 0; /* Remove default margin */
        padding: 0; /* Remove default padding */
        text-align: center; /* Center text */
    }
    
    /* Show invitation list on hover */
    #invitation-icon:hover + .invitation-list {
        display: block; /* Show list on hover */
    }
    
    /* Responsive Navbar for smaller screens */
    @media (max-width: 768px) {
        nav {
            flex-direction: column; /* Stack items vertically */
            text-align: center; /* Center text */
        }
    
        .navbar-left {
            margin-bottom: 10px; /* Space below navbar links */
        }
    
        .invitation-container {
            margin-top: 10px; /* Space above invitation icon */
        }
    
        .navbar-left a {
            display: block; /* Stack links vertically */
            margin: 10px 0; /* Space between links */
        }
    }
    
</style>

<nav>
    <div class="navbar-left">
        <a href="/" data-route="/">Home</a>
        <a href="/users/" data-route="/users/">Users</a>
        <a href="/tournaments/" data-route="/tournaments/">Tournaments</a>
        <a href="/users/{{ request.user.id }}/friends/" data-route="/users/{{ request.user.id }}/friends/">Friends</a>
    </div>
    <div class="invitation-container">
        <a href="#" id="invitation-icon" class="icon">
            ðŸ“¨ <span id="invite-count" class="badge">0</span> <!-- Default count -->
        </a>
        <div id="invitation-list" class="invitation-list">
            <!-- Invitation list items will be inserted here -->
            <p>No invitations</p>
        </div>
    </div>
</nav>

<script>
    const invitationIcon = document.getElementById('invitation-icon');
    const invitationList = document.getElementById('invitation-list');
    const inviteCountElement = document.getElementById('invite-count');

    // Connect to WebSocket
    const InviteSocket = new WebSocket(`ws://${window.location.host}/wss/invitations/`);

    // Listen for messages from the WebSocket
    InviteSocket.onmessage = function (e) {
        const data = JSON.parse(e.data);
        console.log(data);
    
        // Update count and show/hide badge
        const invites = data.invites || [];
        const inviteCount = invites.length;
        inviteCountElement.textContent = inviteCount;
        inviteCountElement.style.display = inviteCount > 0 ? 'inline' : 'none';
    
        // Clear the current list
        invitationList.innerHTML = '';
    
        if (inviteCount > 0) {
            const ul = document.createElement('ul');
            invites.forEach(invite => {
                const li = document.createElement('li');
                
                const avatar = document.createElement('img');
                avatar.src = invite.sender.avatar; // Default avatar if missing
                avatar.width = 30; // Adjust size as needed
                avatar.height = 30; // Adjust size as needed
    
                const userLink = document.createElement('a');
                userLink.href = `/users/${invite.sender.id}`; // Link to user profile
                userLink.dataset.route = `/users/${invite.sender.id}/`; // Add data-route attribute
                userLink.textContent = invite.sender.username || 'Unknown'; // Display username
    
                const text = document.createElement('span');
                text.textContent = ' wants to be friends'; // Adjust as needed
                
                const buttonContainer = document.createElement('div');
                buttonContainer.className = 'invitation-buttons';
    
                const acceptButton = document.createElement('button');
                acceptButton.textContent = 'Accept';
                acceptButton.className = 'accept'; // Added class for acceptance
                acceptButton.dataset.inviteId = invite.id; // Store the invite ID
    
                const denyButton = document.createElement('button');
                denyButton.textContent = 'Deny';
                denyButton.className = 'deny';
                denyButton.dataset.inviteId = invite.id; // Store the invite ID
    
                buttonContainer.appendChild(acceptButton);
                buttonContainer.appendChild(denyButton);
    
                li.appendChild(avatar);
                li.appendChild(userLink);
                li.appendChild(text);
                li.appendChild(buttonContainer);
    
                ul.appendChild(li);
            });
            invitationList.appendChild(ul);
        } else {
            invitationList.innerHTML = '<p>No invitations</p>';
        }
    };
    
    // Handle click events for Accept and Deny buttons
    invitationList.addEventListener('click', function(event) {
        if (event.target.matches('.accept')) {
            // Handle accept logic
            const inviteId = event.target.dataset.inviteId;
            // Send WebSocket message to accept the invitation
            InviteSocket.send(JSON.stringify({
                type: 'friendship',
                result: 'accept',
                id: inviteId
            }));
        } else if (event.target.matches('.deny')) {
            // Handle deny logic
            const inviteId = event.target.dataset.inviteId;
    
            // Send WebSocket message to deny the invitation
            InviteSocket.send(JSON.stringify({
                type: 'friendship',
                result: 'deny',
                id: inviteId
            }));
        }
    });
    
    // Toggle the visibility of the invitation list
    invitationIcon.addEventListener('click', function (event) {
        event.preventDefault();
        invitationList.style.display = invitationList.style.display === 'none' ? 'block' : 'none';
    });
    
    // Optional: Click outside to close the list
    document.addEventListener('click', function (event) {
        if (!invitationIcon.contains(event.target) && !invitationList.contains(event.target)) {
            invitationList.style.display = 'none';
        }
    });
</script>


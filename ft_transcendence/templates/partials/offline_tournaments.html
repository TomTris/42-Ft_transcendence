

<div id="game-container">
    <h1>Game Session: {{ session_id }}</h1>
    <p><div id='status'>{{status}}</div><div id='time'>{{status}}</div></p>
    <p>Player 1: <span id="player1">{{ player1 }}</span></p>
    <p>Player 2: <span id="player2">{{ player2 }}</span></p>
    <div><div id="score1"></div> <div id="score2"></div></div>
    <canvas id="gameCanvas" width="1000" height="600"></canvas>
</div>

<script>
    // JavaScript to connect to WebSocket and update player list
    socket1 = new WebSocket(`wss://${window.location.host}/wss/game/tournament/`);
   
    init();

    socket1.onmessage = function(event) {
        const data = JSON.parse(event.data);
        console.log(data)


        // Prevent multiple forms from being created
        if (data.status === 'Input' && !document.getElementById('inputForm')) {
            // Create and display the form
            const form = document.createElement('form');
            form.id = 'inputForm';
            const inputsData = [data.in1, data.in2, data.in3, data.in4];
            // Create four input fields
            for (let i = 1; i <= 4; i++) {
                const input = document.createElement('input');
                input.type = 'text';
                input.name = 'player' + i;
                input.placeholder = 'player ' + i;
                input.value = inputsData[i - 1] || '';
                
                form.appendChild(input);
                form.appendChild(document.createElement('br'));
            }
    
            // Create the submit button
            const submitButton = document.createElement('button');
            submitButton.type = 'button';
            submitButton.textContent = 'Submit';
            form.appendChild(submitButton);
    
            // Append the form to the game container
            document.getElementById('game-container').appendChild(form);
    
            // Add event listener for the submit button
            submitButton.addEventListener('click', function() {
                // Collect the form data
                const formData = {
                    "type": "input"
                };
                const inputs = form.querySelectorAll('input');
                inputs.forEach(input => {
                    formData[input.name] = input.value;
                });
    
                // Send the form data to the server
                socket1.send(JSON.stringify(formData));
    
                // Remove the form after submission
                form.remove();
            });
        }
        if (data.status === 'Waiting') {

            // Display the "Ready" button
            if (!document.getElementById('readyButton')) {

                const playerContainer = document.createElement('div');
                playerContainer.id = 'playerContainer';
                playerContainer.style.display = 'flex';
                playerContainer.style.justifyContent = 'space-between';
                playerContainer.style.marginTop = '20px';
    
                // Player 1 on the left
                const player1 = document.createElement('div');
                player1.textContent = data.player1 || 'Player 1';
                playerContainer.appendChild(player1);
    
                // Player 2 on the right
                const player2 = document.createElement('div');
                player2.textContent = data.player2 || 'Player 2';
                playerContainer.appendChild(player2);
    
                // Append the player container to the game container
                document.getElementById('game-container').appendChild(playerContainer);

                const readyButton = document.createElement('button');
                readyButton.id = 'readyButton';
                readyButton.textContent = 'Ready';
                readyButton.style.marginTop = '20px';
    
                // Append the button to the game container
                document.getElementById('game-container').appendChild(readyButton);
    
                // Add an event listener for the Ready button
                readyButton.addEventListener('click', function() {
                    socket1.send(JSON.stringify({ 'type': 'ready' }));
                    readyButton.remove(); // Optionally remove the button after clicking
                    playerContainer.remove();
                });
            }
        }

        if (data.status === 'Finished'){
            const playerContainer = document.createElement('div');
            const readyButton = document.createElement('button');
                readyButton.id = 'readyButton';
                readyButton.textContent = 'OK';
                readyButton.style.marginTop = '20px';
    
                // Append the button to the game container
                document.getElementById('game-container').appendChild(readyButton);
    
                // Add an event listener for the Ready button
                readyButton.addEventListener('click', function() {
                    socket1.send(JSON.stringify({ 'type': 'finished' }));
                    readyButton.remove(); // Optionally remove the button after clicking
                    playerContainer.remove();
                });
        }

        if (true)
        {

            document.getElementById('status').textContent = data.status;
            document.getElementById('player1').textContent = data.player1;
            document.getElementById('player2').textContent = data.player2;
            document.getElementById('time').textContent = data.time
            document.getElementById('score1').textContent = data.score1
            document.getElementById('score2').textContent = data.score2
            updateGameCanvas(data);
        }
    };

    function updateGameCanvas(data) {
        //ctx.clearRect(0, 0, data.width, data.height); // Clear the canvas
        //// Draw the paddles and ball
        //ctx.fillStyle = 'black';
        //ctx.fillRect(data.distance, data.pos1, data.pwidth, data.pheight); // Player 1 paddle
        //ctx.fillRect(data.width - data.distance - data.pwidth, data.pos2, data.pwidth, data.pheight); // Player 2 paddle
        //ctx.beginPath();
        //ctx.arc(data.posx, data.posy, 10, 0, 2 * Math.PI); // Ball
        //ctx.fill();
        //console.log(data.posx, data.posy, data.pos1, data.pos2);
        animate(data.posx, data.posy, data.pos1, data.pos2);
    };

    document.addEventListener('keydown', function(event) {
        const key = event.key;
        if ((key == 'f' || key== 'F') && event.repeat) {
            return;
        }
        const message = {
            type: 'keydown',
            key: key
        };
        socket1.send(JSON.stringify(message));
    });

</script>

<style>
    #game-container {
        text-align: center;
        margin-top: 20px;
    }
    canvas {
        border: 1px solid black;
        background: #eee;
        display: block;
        margin: 0 auto;
    }
</style>    
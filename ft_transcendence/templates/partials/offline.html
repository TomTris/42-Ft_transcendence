{% comment %} {% load static %} {% endcomment %}

<div id="game-container">
    <h1>Game Session: {{ session_id }}</h1>
    <p><div id='status'>{{status}}</div><div id='time'>{{status}}</div></p>
    <p>Player 1: <span id="player1">{{ player1 }}</span></p>
    <p>Player 2: <span id="player2">{{ player2 }}</span></p>
    <div><div id="score1"></div> <div id="score2"></div></div>
    <canvas id="gameCanvas" width="1000" height="600"></canvas>
</div>



<script id="playing-bot">
    console.log('yessssss   ');
    init();
    // JavaScript to connect to WebSocket and update player list
    socket1 = new WebSocket(`wss://${window.location.host}/wss/game/offline/`);
    canvas = document.getElementById('gameCanvas');
    ctx = canvas.getContext('2d');


    socket1.onmessage = function(event) {
            const data = JSON.parse(event.data);
            document.getElementById('status').textContent = data.status;
            document.getElementById('player1').textContent = data.player1;
            document.getElementById('player2').textContent = data.player2;
            document.getElementById('time').textContent = data.time
            document.getElementById('score1').textContent = data.score1
            document.getElementById('score2').textContent = data.score2
            updateGameCanvas(data);
    };
    
    function updateGameCanvas(data) {
        //ctx.clearRect(0, 0, data.width, data.height); // Clear the canvas
        //// Draw the paddles and ball
        //ctx.fillStyle = 'black';
        //ctx.fillRect(data.distance, data.pos1, data.pwidth, data.pheight); // Player 1 paddle
        //ctx.fillRect(data.width - data.distance - data.pwidth, data.pos2, data.pwidth, data.pheight); // Player 2 paddle
        //ctx.beginPath();
        //ctx.arc(data.posx, data.posy, 10, 0, 2 * Math.PI); // Ball
        //ctx.fill();
        //console.log(data.posx, data.posy, data.pos1, data.pos2);
        animate(data.posx, data.posy, data.pos1, data.pos2);
    };

    document.addEventListener('keydown', function(event) {
        let key = event.key;

        if ((key == 'f' || key== 'F' || key == 'v' || key == 'V') && event.repeat ) {
            return;
        }
        if ((key == 'v' || key== 'V') ) {
            cameraView += 1;
            cameraView %= 3;
            return;
        }

        if ((key == 'w' || key == "W" || key == 'ArrowUp' || key == 'ArrowDown' || key == 's' || key == 'S') && cameraView != 0)
            return;
        if ((key == 'a' || key == 'A' || key == 'ArrowLeft' || key == 'ArrowRight' || key == 'd' || key == 'D') && cameraView == 0)
        {
            return;
        }
        else{
            if (cameraView == 1)
            {
                if (key == 'a' || key == 'A')
                    key = 's';
                else if (key == 'ArrowLeft')
                    key = 'ArrowDown';
                else if (key == 'd' || key == 'D')
                    key = 'w';
                else if (key == 'ArrowRight')
                    key = 'ArrowUp';
            }
            else
            {
                if (key == 'a' || key == 'A')
                    key = 'w';
                else if (key == 'ArrowLeft')
                    key = 'ArrowUp';
                else if (key == 'd' || key == 'D')
                    key = 's';
                else if (key == 'ArrowRight')
                    key = 'ArrowDown';
            }
        } 
        const message = {
            type: 'keydown',
            key: key
        };
        socket1.send(JSON.stringify(message));
    });

</script>
<style>
    #game-container {
        text-align: center;
        margin-top: 20px;
    }
    canvas {
        border: 1px solid black;
        background: #eee;
        display: block;
        margin: 0 auto;
    }
</style>    
